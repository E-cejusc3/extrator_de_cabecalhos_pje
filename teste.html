<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Extrator de Cabeçalhos PJe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        :root {
            --bg-color: #ffffff;
            --text-color: #1f2937;
            --input-bg-color: #f9fafb;
            --input-border-color: #d1d5db;
            --primary-color: #3b82f6;
            --secondary-color: #10b981;
            --danger-color: #ef4444;
            --card-bg: #ffffff;
            --card-border: #e5e7eb;
            --tab-bg: #e5e7eb;
            --tab-active-bg: #ffffff;
            --tab-active-text: #111827;
            --tab-inactive-text: #4b5563;
        }

        body.dark {
            --bg-color: #111827;
            --text-color: #e5e7eb;
            --input-bg-color: #1f2937;
            --input-border-color: #4b5563;
            --primary-color: #60a5fa;
            --secondary-color: #34d399;
            --danger-color: #f87171;
            --card-bg: #1f2937;
            --card-border: #374151;
            --tab-bg: #1f2937;
            --tab-active-bg: #374151;
            --tab-active-text: #f9fafb;
            --tab-inactive-text: #9ca3af;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.3s, color 0.3s;
            font-family: 'Inter', sans-serif;
        }

        /* --- Estilos do Extrator --- */
        #alert-box {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
            padding: 1rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: bold;
            background-color: var(--secondary-color);
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        #extrator-view textarea {
            width: 100%;
            height: 100px;
            margin-bottom: 10px;
            font-family: Arial, sans-serif;
            font-size: 16px;
            background-color: var(--input-bg-color);
            color: var(--text-color);
            border: 1px solid var(--input-border-color);
            border-radius: 8px;
            padding: 8px;
        }

        .botao {
            border: none;
            color: #fff;
            padding: 10px 24px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 8px;
            transition: transform 0.2s ease, background-color 0.2s ease;
        }
        .botao:hover {
            transform: translateY(-2px);
        }

        #extrairTextoCopiado { background-color: #2E8B57; }
        #limparCaixas { background-color: #F08080; }
        #copiarDados { background-color: #4682B4; }
        #gerarWord { background-color: #708090; }
        #extrairTextoCopiado:hover { background-color: #3CB371; }
        #limparCaixas:hover { background-color: #CD5C5C; }
        #copiarDados:hover { background-color: #5F9EA0; }
        #gerarWord:hover { background-color: #778899; }
        
        .tabela-dados-pje {
            width: 100%;
            max-width: 800px;
            border-collapse: collapse;
            margin-top: 20px;
            background-color: var(--card-bg);
            border: 1px solid var(--card-border);
        }
        .tabela-dados-pje td {
            border: 1px solid var(--card-border);
            padding: 10px;
        }
        .titulo-tabela { text-align: center; }
        .titulo-principal { text-decoration: underline; }

        /* --- Estilos das Abas --- */
        .tab-button {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            font-weight: 600;
            border-radius: 0.5rem 0.5rem 0 0;
            background-color: var(--tab-bg);
            color: var(--tab-inactive-text);
            transition: all 0.2s ease-in-out;
            border: 1px solid transparent;
            border-bottom: none;
        }
        .tab-button.active {
            background-color: var(--card-bg);
            color: var(--tab-active-text);
            border-color: var(--card-border);
        }
        
        /* --- Estilos de Cláusulas, Editor e Modal REMOVIDOS --- */

    </style>
</head>
<body class="p-4 md:p-8">

    <header class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6">
        <div>
            <h1 class="text-3xl font-bold">Extrator de Cabeçalhos PJe</h1>
            <p class="text-sm text-gray-500 dark:text-gray-400">Extrator de Cabeçalhos e Gestor de Cláusulas</p>
        </div>
        <div class="fixed top-4 right-4 z-50 text-center flex items-center gap-4">
            <div id="Autor" class="text-xs text-gray-500 dark:text-gray-400 hidden sm:block">
                e-CEJUSC 3/TJDFT | 04/11/25 19:23 <br><a href="https://tjdf.sharepoint.com/sites/eCEJUSC3/_layouts/15/stream.aspx?id=%2Fsites%2FeCEJUSC3%2FPasta%20de%20rede%2F04%20V%C3%ADdeos%20Instrut%C3%B3rios%2F07%2E%20Ferramentas%20Adicionais%2F01%20-%20Extrator%20PJe%2Emp4" target="_blank">❓ Como utilizar? </a>
            </div>
            <label>
                <input type="checkbox" id="theme-toggle" class="hidden">
                <span id="theme-label" class="cursor-pointer p-3 bg-gray-200 dark:bg-gray-700 rounded-full flex items-center justify-center">
                    <i id="theme-icon" class="fas fa-moon"></i>
                </span>
            </label>
        </div>
    </header>

    <main>
        <div id="extrator-view">
            <textarea id="caixa1" placeholder="Após abrir o cabeçalho do processo no PJe e copiar todos os dados apertando Ctrl+A e Ctrl+C, cole aqui ou clique no botão 'Extrair texto copiado'"></textarea>
            <textarea id="caixa2" class="hidden"></textarea>
            <textarea id="caixa3" class="hidden"></textarea>
            <textarea id="caixa4" class="hidden"></textarea>
            <textarea id="caixa5" class="hidden"></textarea>
            <textarea id="caixa6" class="hidden"></textarea>
            <textarea id="caixa7" class="hidden"></textarea>
            
            <div class="flex flex-wrap gap-2 mb-6">
                <button class="botao" id="extrairTextoCopiado" onclick="extrairClipboard()">Extrair texto copiado</button>
                <button class="botao" id="limparCaixas" onclick="limparCaixas()">Limpar Caixas</button>
                <button class="botao" id="copiarDados" onclick="copiarDadosFormatados()">Copiar Cabeçalho</button>
               <a href="antigo.html"> <button class="botao" id="gerarWord" type="button">Versão antiga</button></a>
</a> 
            </div>
      
            <div id="dados-para-copiar" class="space-y-6">
                <table class="tabela-dados-pje">
                    <tbody><tr><td>
                        <p class="titulo-tabela"><span class="titulo-principal">DADOS EXTRAÍDOS DO PJE</span></p>
                        <div id="output1"></div>
                    </td></tr></tbody>
                </table>
                <table class="tabela-dados-pje">
                    <tbody><tr><td>
                        <p class="titulo-tabela"><span class="titulo-principal">PARTICIPANTES DA AUDIÊNCIA</span></p>
                        <div id="output2"></div>
                    </td></tr></tbody>
                </table>
                <table class="tabela-dados-pje">
                    <tbody><tr><td>
                        <p class="titulo-tabela">
                            <span class="titulo-principal">DADOS DAS PARTES</span><br>
                            <span class="subtitulo-tabela text-xs">(Portaria Conjunta GPR, GPVP, GSVP e GC n.º 71/2013; e CPC, art. 319, II) </span>
                        </p>
                        <div id="output3"></div>
                    </td></tr></tbody>
                </table>
            </div>
        </div>

        </main>

    <div id="alert-box"></div>

    <script type="module">
    // Importações do Firebase REMOVIDAS
    
    // --- CONFIGURAÇÃO FIREBASE REMOVIDA ---
    
    // Inicialização do Firebase REMOVIDA
    
    // --- LÓGICA GERAL E DE ABAS ---

    // Função initializeQuillEditor REMOVIDA

    window.showTab = (tabName) => {
        document.getElementById('extrator-view').classList.add('hidden');
        // Linha de 'clausulas-view' removida
        document.getElementById('tab-extrator').classList.remove('active');
        // Linha de 'tab-clausulas' removida
        document.getElementById(`${tabName}-view`).classList.remove('hidden');
        document.getElementById(`tab-${tabName}`).classList.add('active');
    }

    window.showAlert3s = (message) => {
        const alertBox = document.getElementById('alert-box');
        alertBox.textContent = message || 'Ação concluída com sucesso!';
        alertBox.style.display = 'block';
        setTimeout(() => {
            alertBox.style.display = 'none';
        }, 3000);
    }

    // Funções openModal e closeModal REMOVIDAS

    // --- LÓGICA DAS CLÁUSULAS REMOVIDA ---


    // --- LÓGICA DO EXTRATOR DE CABEÇALHOS ---
    window.extrairClipboard = () => {
        navigator.clipboard.readText().then(text => {
            document.getElementById('caixa1').value = text;
            processarCaixas();
        }).catch(err => {
            console.error('Falha ao ler da área de transferência: ', err);
            showAlert3s('Erro ao acessar a área de transferência.');
        });
    }

    window.limparCaixas = () => {
        for (let i = 1; i <= 7; i++) {
            document.getElementById('caixa' + i).value = '';
        }
        document.getElementById('output1').innerHTML = '';
        document.getElementById('output2').innerHTML = '';
        document.getElementById('output3').innerHTML = '';
    }

    // ===================================================================
    // FUNÇÃO DE COPIAR CABEÇALHO CORRIGIDA (JUSTIFICADO APENAS NO OUTPUT 3)
    // ===================================================================
    window.copiarDadosFormatados = () => {
    const output1 = document.getElementById('output1').innerHTML;
    const output2 = document.getElementById('output2').innerHTML;
    const output3 = document.getElementById('output3').innerHTML;

    if (!output1 && !output2 && !output3) {
        showAlert3s('Não há dados para copiar.');
        return;
    }

    const htmlString = `
        <div style="font-family: Arial, sans-serif; font-size: 12pt; line-height: 18pt;">
            <table style="border-collapse: collapse; width: 100%; border: 1px solid black;">
                <tbody>
                    <tr>
                        <td style="border: 1px solid black; padding: 5pt; line-height: 18pt;">
                            <p style="text-align: center; font-family: Arial, sans-serif; font-size: 12pt; line-height: 18pt;"><strong style="text-decoration: underline;">DADOS EXTRAÍDOS DO PJE</strong></p>
                            <div style="font-family: Arial, sans-serif; font-size: 12pt; line-height: 18pt;">${output1}</div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <p style="font-family: Arial, sans-serif; font-size: 6pt; margin: 0; padding: 0;">&nbsp;</p>
            <table style="border-collapse: collapse; width: 100%; border: 1px solid black;">
                <tbody>
                    <tr>
                        <td style="border: 1px solid black; padding: 5pt; line-height: 18pt;">
                            <p style="text-align: center; font-family: Arial, sans-serif; font-size: 12pt; line-height: 18pt;"><strong style="text-decoration: underline;">PARTICIPANTES DA AUDIÊNCIA</strong></p>
                            <div style="font-family: Arial, sans-serif; font-size: 12pt; line-height: 18pt;">${output2}</div>
                        </td>
                    </tr>
                </tbody>
            </table>
            <p style="font-family: Arial, sans-serif; font-size: 6pt; margin: 0; padding: 0;">&nbsp;</p>
            <table style="border-collapse: collapse; width: 100%; border: 1px solid black;">
                <tbody>
                    <tr>
                        <td style="border: 1px solid black; padding: 5pt; line-height: 18pt;">
                            <p style="text-align: center; font-family: Arial, sans-serif; font-size: 12pt; line-height: 18pt;">
                                <strong style="text-decoration: underline;">DADOS DAS PARTES</strong><br>
                                <span style="font-size: 9pt;">(Portaria Conjunta GPR, GPVP, GSVP e GC n.º 71/2013; e CPC, art. 319, II)</span>
                            </p>
                            <div style="font-family: Arial, sans-serif; font-size: 12pt; line-height: 18pt; text-align: justify;">${output3}</div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    `;

    const blob = new Blob([htmlString], { type: 'text/html' });
    const clipboardItem = new ClipboardItem({ 'text/html': blob });

    navigator.clipboard.write([clipboardItem]).then(() => {
        showAlert3s('Cabeçalho copiado com sucesso! Lembre-se de alterar a forma de colar no Word para "Manter a formatação original"');
    }).catch(err => {
        console.error('Falha ao copiar o cabeçalho: ', err);
        showAlert3s('Erro ao copiar o cabeçalho.');
    });
};
    // ===================================================================
    // FIM DA FUNÇÃO CORRIGIDA
    // ===================================================================

    window.processarCaixas = () => {
        const caixa1 = document.getElementById('caixa1').value.split('\n');
        if (caixa1.length > 1) {
            document.getElementById('caixa2').value = caixa1[1].replace(/[^\d\W]/g, '');
        }
        const orgaoJulgadorIndex = caixa1.findIndex(line => line.includes('Órgão julgador'));
        if (orgaoJulgadorIndex !== -1 && orgaoJulgadorIndex + 1 < caixa1.length) {
            document.getElementById('caixa3').value = caixa1[orgaoJulgadorIndex + 1];
        }
        const poloAtivoIndex = caixa1.findIndex(line => line.includes('Polo ativo'));
        const poloPassivoIndex = caixa1.findIndex(line => line.includes('Polo passivo'));
        if (poloAtivoIndex !== -1 && poloPassivoIndex !== -1 && poloAtivoIndex < poloPassivoIndex) {
            const requerentes = caixa1.slice(poloAtivoIndex + 1, poloPassivoIndex).filter(line => !line.startsWith(' ')).map(line => line.replace('Parte cadastrada no Domicilio Judicial Eletrônico - Resolução CNJ Nº 455 de 27/04/2022 ', '')).filter(line => !line.includes('Procuradoria cadastrada no'));
            document.getElementById('caixa4').value = requerentes.join('\n');
        }
        const iconeDownloadIndex = caixa1.findIndex(line => line.includes('Ícone de download'));
        if (poloPassivoIndex !== -1 && iconeDownloadIndex !== -1 && iconeDownloadIndex > poloPassivoIndex) {
            // const requeridos = caixa1.slice(poloPassivoIndex + 1, iconeDownloadIndex).filter(line => /(REQUERIDO|RÉU|REU|EXECUTADO|EMBARGADO|REQUERIDO ESPÓLIO DE)\)$/.test(line.trim())).map(line => line.replace('Parte cadastrada no Domicilio Judicial Eletrônico - Resolução CNJ Nº 455 de 27/04/2022 ', ''));
            document.getElementById('caixa6').value = requeridos.join('\n');
        }
        document.getElementById('caixa5').value = formatarRequerentes(document.getElementById('caixa4').value.split('\n'));
        document.getElementById('caixa7').value = formatarRequeridos(document.getElementById('caixa6').value.split('\n'));
        atualizarOutputs();
    }

    const formatarRequerentes = (requerentes) => {
        if (requerentes.length === 1) {
            // return `<b>Requerente:</b> ${requerentes[0].replace(/ \((REQUERENTE|AUTOR|EXEQUENTE|AUTORA|EMBARGANTE|REQUERENTE ESPÓLIO DE)\)/g, '')}`;
        }
        // return requerentes.map((req, index) => `<b>${index + 1}º Requerente:</b> ${req.replace(/ \((REQUERENTE|AUTOR|EXEQUENTE|AUTORA|EMBARGANTE|REQUERENTE ESPÓLIO DE)\)/g, '')}`).join('\n');
    }

    const formatarRequeridos = (requeridos) => {
        if (requeridos.length === 1) {
            // return `<b>Requerido(a):</b> ${requeridos[0].replace(/ \((REQUERIDO|RÉU|REU|EXECUTADO|EMBARGADO|REQUERIDO ESPÓLIO DE)\)/g, '')}`;
        }
        // return requeridos.map((req, index) => `<b>${index + 1}º Requerido(a):</b> ${req.replace(/ \((REQUERIDO|RÉU|REU|EXECUTADO|EMBARGADO|REQUERIDO ESPÓLIO DE)\)/g, '')}`).join('\n');
    }

    const atualizarOutputs = () => {
        const caixa4 = document.getElementById('caixa4').value.split('\n');
        const caixa6 = document.getElementById('caixa6').value.split('\n');
        const hasExequente = caixa4.some(line => /\(EXEQUENTE\)$/.test(line.trim()));
        const hasExecutado = caixa6.some(line => /\(EXECUTADO\)$/.test(line.trim()));
        const hasEmbargante = caixa4.some(line => /\(EMBARGANTE\)$/.test(line.trim()));
        const hasEmbargado = caixa6.some(line => /\(EMBARGADO\)$/.test(line.trim()));
        const exequenteTermo = hasExequente ? 'Exequente' : hasEmbargante ? 'Embargante' : 'Requerente';
        const executadoTermo = hasExecutado ? 'Executado(a)' : hasEmbargado ? 'Embargado(a)' : 'Requerido(a)';
        const exequenteParte = hasExequente ? 'EXEQUENTE' : hasEmbargante ? 'EMBARGANTE' : 'REQUERENTE';
        const executadoParte = hasExecutado ? 'EXECUTADA' : hasEmbargado ? 'EMBARGADA' : 'REQUERIDA';
        const caixa8 = `<b>Juízo:</b> ${document.getElementById('caixa3').value}\n` +
            `<b>Processo:</b> ${document.getElementById('caixa2').value}\n` +
            `${document.getElementById('caixa5').value.replace(/Requerente:/g, `${exequenteTermo}:`)}\n` +
            `${document.getElementById('caixa7').value.replace(/Requerido\(a\):/g, `${executadoTermo}:`)}`;
        const caixa9 = caixa8.split('\n').slice(2).map(line => `${line.trim()}<br><b>Telefone:</b> Número<br><b>Preposto(a):</b> nome completo, <b>CPF:</b> número, <b>telefone:</b> número (<b>Carta de preposto ID n. xxxx</b>).<br><b>Advogado(a):</b> nome completo, <b>OAB/DF:</b> número, <b>telefone:</b> número (<b>Procuração ID xxxx</b>).<br><br>`).join('').replace(/^\s+/gm, '');
        const textoAdicional = `<b>Observador(es):</b> Nome completo, CPF, (...), que assume(m) o dever de confidencialidade (CPC, art. 166, § 1º).<br><br><b>Conciliador(es)/Mediador(es):</b> Nome completo &emsp; <b>Sala:</b> número da sala<br><br><b>Supervisor(es):</b> Nome se houver e <b>Matrícula:</b> número`;
        const formatBold = text => text.replace(/(CPF:|CNPJ:)/g, '<b>$1</b>');
        document.getElementById('output1').innerHTML = formatBold(caixa8).replace(/\n/g, '<br>');
        document.getElementById('output2').innerHTML = formatBold(caixa9 + textoAdicional);
        
        // const requerentes = caixa4.map(req => req.replace(/ \((REQUERENTE|AUTOR|EXEQUENTE|AUTORA|EMBARGANTE|REQUERENTE ESPÓLIO DE)\)/g, '').trim());
        // const requeridos = caixa6.map(req => req.replace(/ \((REQUERIDO|RÉU|REU|EXECUTADO|EMBARGADO|REQUERIDO ESPÓLIO DE)\)/g, '').trim());
        
        let output3Content = '';
        requerentes.forEach((req, index) => {
            const prefix = requerentes.length > 1 ? `A parte ${index + 1}ª ${exequenteParte}` : `A parte ${exequenteParte}`;
            const type = req.includes('CNPJ:') ? 'pessoa jurídica estabelecida no(a)' : 'residente e domiciliado(a)';
            output3Content += `<p><b>${prefix}: ${req}</b>, ${type} xxxx, telefone xxxx e e-mail xxxx.</p>`;
        });
         requeridos.forEach((req, index) => {
            const prefix = requeridos.length > 1 ? `A parte ${index + 1}ª ${executadoParte}` : `A parte ${executadoParte}`;
            const type = req.includes('CNPJ:') ? 'pessoa jurídica estabelecida no(a)' : 'residente e domiciliado(a)';
            output3Content += `<p><b>${prefix}: ${req}</b>, ${type} xxxx, telefone xxxx e e-mail xxxx.</p>`;
        });
        document.getElementById('output3').innerHTML = output3Content;
    }

    function gerarWord() {
    var urlDeRedirecionamento = "https://e-cejusc3.github.io/extrator_de_cabecalhos_pje/antigo.html";
    
    // Esta linha faz o redirecionamento.
    window.location.href = urlDeRedirecionamento; 
}

    // --- TEMA CLARO/ESCURO ---
    const themeToggle = document.getElementById("theme-toggle");
    const themeIcon = document.getElementById("theme-icon");
    const body = document.body;
    const savedTheme = localStorage.getItem("theme") || "light";
    body.classList.toggle("dark", savedTheme === "dark");
    themeIcon.className = savedTheme === "dark" ? "fas fa-sun" : "fas fa-moon";
    themeToggle.addEventListener("change", () => {
        const isDark = body.classList.toggle("dark");
        themeIcon.className = isDark ? "fas fa-sun" : "fas fa-moon";
        localStorage.setItem("theme", isDark ? "dark" : "light");
    });
</script>
</body>
</html>